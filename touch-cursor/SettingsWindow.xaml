<Window x:Class="touch_cursor.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="TouchCursor Settings" Height="600" Width="700"
        WindowStartupLocation="CenterScreen"
        ResizeMode="CanResize"
        ShowInTaskbar="True"
        StateChanged="Window_StateChanged"
        Closing="Window_Closing">
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock x:Name="HeaderTextBlock" Grid.Row="0" FontSize="20" FontWeight="Bold" Margin="0,0,0,20">
            Advanced Settings
        </TextBlock>

        <!-- Tab Control for different settings -->
        <TabControl x:Name="MainTabControl" Grid.Row="1" Margin="0,0,0,20">
            <!-- General Tab -->
            <TabItem x:Name="GeneralTab" Header="General">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <GroupBox x:Name="ActivationKeyProfilesGroupBox" Header="Activation Key Profiles" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <TextBlock x:Name="ActivationKeyProfilesDescriptionTextBlock" TextWrapping="Wrap" Margin="0,0,0,10">
                                    Manage multiple activation keys, each with their own key mappings:
                                </TextBlock>
                                <ListBox x:Name="ActivationKeyProfilesListBox" Height="120" Margin="0,0,0,10"
                                         SelectionChanged="ActivationKeyProfilesListBox_SelectionChanged">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding KeyName}" Width="150" FontWeight="Bold"/>
                                                <TextBlock Text="{Binding MappingCount}" Foreground="Gray"/>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="AddActivationKeyButton" Content="Add Profile..." Width="100" Margin="0,0,5,0"
                                            Click="AddActivationKeyButton_Click"/>
                                    <Button x:Name="RemoveActivationKeyButton" Content="Remove Profile" Width="120"
                                            Click="RemoveActivationKeyButton_Click"
                                            IsEnabled="False"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox x:Name="BehaviorGroupBox" Header="Behavior" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <CheckBox x:Name="EnabledCheckBox" Content="Enable TouchCursor"
                                          IsChecked="False" Margin="0,5"
                                          Checked="EnabledCheckBox_Changed"
                                          Unchecked="EnabledCheckBox_Changed"/>
                                <CheckBox x:Name="TrainingModeCheckBox" Content="Training Mode"
                                          IsChecked="False" Margin="0,5"
                                          Checked="TrainingModeCheckBox_Changed"
                                          Unchecked="TrainingModeCheckBox_Changed"/>
                                <CheckBox x:Name="RunAtStartupCheckBox" Content="Run at Windows startup"
                                          IsChecked="False" Margin="0,5"
                                          Checked="RunAtStartupCheckBox_Changed"
                                          Unchecked="RunAtStartupCheckBox_Changed"/>
                                <CheckBox x:Name="ShowInTrayCheckBox" Content="Show icon in notification area"
                                          IsChecked="True" Margin="0,5"
                                          Checked="ShowInTrayCheckBox_Changed"
                                          Unchecked="ShowInTrayCheckBox_Changed"/>
                                <CheckBox x:Name="CheckUpdatesCheckBox" Content="Automatically check for updates"
                                          IsChecked="True" Margin="0,5"
                                          Checked="CheckUpdatesCheckBox_Changed"
                                          Unchecked="CheckUpdatesCheckBox_Changed"/>
                                <CheckBox x:Name="BeepForMistakesCheckBox" Content="Beep for mistakes in training mode"
                                          IsChecked="False" Margin="0,5"
                                          Checked="BeepForMistakesCheckBox_Changed"
                                          Unchecked="BeepForMistakesCheckBox_Changed"/>
                                <CheckBox x:Name="TypingAnalyticsCheckBox" Content="Enable Typing Analytics (ML data collection)"
                                          IsChecked="False" Margin="0,5"
                                          Checked="TypingAnalyticsCheckBox_Changed"
                                          Unchecked="TypingAnalyticsCheckBox_Changed"/>
                                <CheckBox x:Name="AutoSwitchToEnglishCheckBox" Content="Auto-switch to English on non-consonant (Korean IME)"
                                          IsChecked="False" Margin="0,5"
                                          Checked="AutoSwitchToEnglishCheckBox_Changed"
                                          Unchecked="AutoSwitchToEnglishCheckBox_Changed"/>

                                <Separator Margin="0,10,0,10"/>

                                <TextBlock x:Name="HoldDelayLabel" TextWrapping="Wrap" Margin="0,5,0,5">
                                    활성화 키 홀드 딜레이 (ms):
                                </TextBlock>
                                <TextBlock x:Name="HoldDelayDescription" TextWrapping="Wrap" Margin="0,0,0,5" FontSize="11" Foreground="Gray">
                                    활성화 키를 이 시간만큼 눌러야 커서 모드가 활성화됩니다. 빠른 타이핑 중 의도치 않은 활성화를 방지합니다. 0으로 설정하면 즉시 활성화됩니다.
                                </TextBlock>
                                <Grid Margin="0,5,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="HoldDelaySlider"
                                            Grid.Column="0"
                                            Minimum="0" Maximum="300"
                                            TickFrequency="10"
                                            IsSnapToTickEnabled="True"
                                            Value="0"
                                            Margin="0,0,10,0"
                                            ValueChanged="HoldDelaySlider_ValueChanged"/>
                                    <TextBlock x:Name="HoldDelayValueText"
                                               Grid.Column="1"
                                               Text="0 ms"
                                               VerticalAlignment="Center"
                                               Width="50"/>
                                </Grid>

                                <TextBlock x:Name="RolloverThresholdLabel" TextWrapping="Wrap" Margin="0,5,0,5">
                                    롤오버 감지 임계값 (ms):
                                </TextBlock>
                                <TextBlock x:Name="RolloverThresholdDescription" TextWrapping="Wrap" Margin="0,0,0,5" FontSize="11" Foreground="Gray">
                                    활성화 키 누른 후 이 시간 내에 키를 누르면 두 키 모두 일반 타이핑으로 처리합니다. 낮은 값은 커서 모드를 더 빠르게 하지만 빠른 타이핑 중 오작동할 수 있습니다.
                                </TextBlock>
                                <Grid Margin="0,5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <Slider x:Name="RolloverThresholdSlider"
                                            Grid.Column="0"
                                            Minimum="0" Maximum="200"
                                            TickFrequency="10"
                                            IsSnapToTickEnabled="True"
                                            Value="50"
                                            Margin="0,0,10,0"
                                            ValueChanged="RolloverThresholdSlider_ValueChanged"/>
                                    <TextBlock x:Name="RolloverThresholdValueText"
                                               Grid.Column="1"
                                               Text="50 ms"
                                               VerticalAlignment="Center"
                                               Width="50"/>
                                </Grid>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox x:Name="LanguageGroupBox" Header="Language" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <TextBlock x:Name="LanguageDescriptionTextBlock" TextWrapping="Wrap" Margin="0,0,0,10">
                                    Select your preferred language:
                                </TextBlock>
                                <ComboBox x:Name="LanguageComboBox"
                                          Width="200" HorizontalAlignment="Left"
                                          DisplayMemberPath="NativeName"
                                          SelectedValuePath="Code"
                                          SelectionChanged="LanguageComboBox_SelectionChanged"/>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox x:Name="AboutGroupBox" Header="About" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <TextBlock x:Name="AboutTitleTextBlock" TextWrapping="Wrap" Margin="0,5">
                                    <Bold>TouchCursor for Windows</Bold>
                                </TextBlock>
                                <TextBlock x:Name="AboutVersionTextBlock" TextWrapping="Wrap" Margin="0,5">
                                    Version: 2.0.0 (C# Edition)
                                </TextBlock>
                                <TextBlock x:Name="AboutOriginalTextBlock" TextWrapping="Wrap" Margin="0,5">
                                    Ported from original TouchCursor by Martin Stone
                                </TextBlock>
                                <TextBlock x:Name="AboutLicenseTextBlock" TextWrapping="Wrap" Margin="0,5">
                                    Licensed under GNU GPL v3.0
                                </TextBlock>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>

            <!-- Key Mappings Tab -->
            <TabItem x:Name="KeyMappingsTab" Header="Key Mappings">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock x:Name="CurrentKeyMappingsTextBlock" Grid.Row="0" TextWrapping="Wrap" Margin="0,0,0,10" FontWeight="Bold">
                        Current Key Mappings
                    </TextBlock>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock x:Name="SelectActivationKeyTextBlock" Text="Activation Key:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                        <ComboBox x:Name="KeyMappingActivationKeyComboBox" Width="200"
                                  DisplayMemberPath="KeyName"
                                  SelectedValuePath="VkCode"
                                  SelectionChanged="KeyMappingActivationKeyComboBox_SelectionChanged"/>
                    </StackPanel>

                    <TextBlock x:Name="KeyMappingsNoteTextBlock" Grid.Row="2" TextWrapping="Wrap" Margin="0,0,0,15" Foreground="Gray">
                        Click on a mapping and use the buttons below to edit or remove it.
                    </TextBlock>

                    <DataGrid x:Name="KeyMappingsDataGrid" Grid.Row="3"
                              AutoGenerateColumns="False"
                              GridLinesVisibility="All"
                              HeadersVisibility="Column"
                              SelectionMode="Single"
                              SelectionChanged="KeyMappingsDataGrid_SelectionChanged"
                              MouseDoubleClick="KeyMappingsDataGrid_MouseDoubleClick">
                        <DataGrid.Columns>
                            <DataGridTextColumn x:Name="ColumnActivationKey" Header="Activation Key +" Width="150" Binding="{Binding SourceKey}" IsReadOnly="True"/>
                            <DataGridTextColumn x:Name="ColumnMapsTo" Header="Maps To" Width="150" Binding="{Binding TargetKey}" IsReadOnly="True"/>
                            <DataGridCheckBoxColumn x:Name="ColumnIgnoreRollover" Header="Ignore Rollover" Width="120" Binding="{Binding IgnoreRollover, UpdateSourceTrigger=PropertyChanged}"/>
                            <DataGridTextColumn x:Name="ColumnDescription" Header="Description" Width="*" Binding="{Binding Description}" IsReadOnly="True"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0,10,0,0" HorizontalAlignment="Left">
                        <Button x:Name="AddMappingButton" Content="Add..." Width="80" Margin="0,0,5,0"
                                Click="AddMappingButton_Click"/>
                        <Button x:Name="EditMappingButton" Content="Edit..." Width="80" Margin="0,0,5,0"
                                Click="EditMappingButton_Click"
                                IsEnabled="False"/>
                        <Button x:Name="RemoveMappingButton" Content="Remove" Width="80"
                                Click="RemoveMappingButton_Click"
                                IsEnabled="False"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <!-- Program Lists Tab -->
            <TabItem x:Name="ProgramListsTab" Header="Program Lists">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="10">
                        <TextBlock x:Name="ProgramSpecificTextBlock" TextWrapping="Wrap" Margin="0,0,0,10" FontWeight="Bold">
                            Program-Specific Settings
                        </TextBlock>
                        <TextBlock x:Name="ProgramSpecificNoteTextBlock" TextWrapping="Wrap" Margin="0,0,0,15" Foreground="Gray">
                            Configure which programs TouchCursor should be enabled or disabled in.
                        </TextBlock>

                        <GroupBox x:Name="DisableProgsGroupBox" Header="Disable in these programs" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <ListBox x:Name="DisableProgsListBox" Height="150" Margin="0,0,0,10"/>
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="AddDisableProgButton" Content="Add..." Width="80" Margin="0,0,5,0"
                                            Click="AddDisableProg_Click"/>
                                    <Button x:Name="RemoveDisableProgButton" Content="Remove" Width="80"
                                            Click="RemoveDisableProg_Click"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>

                        <GroupBox x:Name="EnableProgsGroupBox" Header="Enable only in these programs" Margin="0,0,0,15">
                            <StackPanel Margin="10">
                                <CheckBox x:Name="UseEnableListCheckBox"
                                          Content="Use enable list (TouchCursor will only work in listed programs)"
                                          Margin="0,0,0,10"
                                          Checked="UseEnableListCheckBox_Changed"
                                          Unchecked="UseEnableListCheckBox_Changed"/>
                                <ListBox x:Name="EnableProgsListBox" Height="150" Margin="0,0,0,10"
                                         IsEnabled="{Binding IsChecked, ElementName=UseEnableListCheckBox}"/>
                                <StackPanel Orientation="Horizontal">
                                    <Button x:Name="AddEnableProgButton" Content="Add..." Width="80" Margin="0,0,5,0"
                                            Click="AddEnableProg_Click"
                                            IsEnabled="{Binding IsChecked, ElementName=UseEnableListCheckBox}"/>
                                    <Button x:Name="RemoveEnableProgButton" Content="Remove" Width="80"
                                            Click="RemoveEnableProg_Click"
                                            IsEnabled="{Binding IsChecked, ElementName=UseEnableListCheckBox}"/>
                                </StackPanel>
                            </StackPanel>
                        </GroupBox>
                    </StackPanel>
                </ScrollViewer>
            </TabItem>
        </TabControl>

        <!-- Bottom Buttons -->
        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button x:Name="ResetButton" Content="Reset to Defaults" Width="120" Height="30" Margin="0,0,10,0"
                    Click="ResetButton_Click"/>
            <Button x:Name="OkButton" Content="OK" Width="80" Height="30" Margin="0,0,10,0"
                    IsDefault="True" Click="OkButton_Click"/>
            <Button x:Name="CancelButton" Content="Cancel" Width="80" Height="30"
                    IsCancel="True" Click="CancelButton_Click"/>
        </StackPanel>
    </Grid>
</Window>
