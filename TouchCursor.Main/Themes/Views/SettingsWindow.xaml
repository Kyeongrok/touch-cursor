<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:views="clr-namespace:TouchCursor.Main.UI.Views"
                    xmlns:vm="clr-namespace:TouchCursor.Main.ViewModels"
                    xmlns:loc="clr-namespace:TouchCursor.Main.Localization">

    <Style TargetType="{x:Type views:SettingsWindow}">
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type views:SettingsWindow}">
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}">
                        <Grid Margin="20">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Header -->
                            <TextBlock Grid.Row="0"
                                       Text="{loc:Localize SettingsWindow.Header}"
                                       FontSize="20" FontWeight="Bold" Margin="0,0,0,20"/>

                            <!-- Tab Control -->
                            <TabControl Grid.Row="1" Margin="0,0,0,20">
                                <!-- General Tab -->
                                <TabItem Header="{loc:Localize SettingsWindow.TabGeneral}">
                                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                                        <StackPanel Margin="10">
                                            <!-- Activation Key Profiles -->
                                            <GroupBox Header="{loc:Localize SettingsWindow.ActivationKeyProfiles}" Margin="0,0,0,15">
                                                <StackPanel Margin="10">
                                                    <TextBlock Text="{loc:Localize SettingsWindow.ActivationKeyProfilesDescription}"
                                                               TextWrapping="Wrap" Margin="0,0,0,10"/>
                                                    <ListBox x:Name="PART_ActivationKeyProfilesListBox"
                                                             Height="120" Margin="0,0,0,10"
                                                             ItemsSource="{Binding ActivationKeyProfiles}"
                                                             SelectedItem="{Binding SelectedActivationKeyProfile}">
                                                        <ListBox.ItemTemplate>
                                                            <DataTemplate DataType="{x:Type vm:ActivationKeyProfileViewModel}">
                                                                <StackPanel Orientation="Horizontal">
                                                                    <TextBlock Text="{Binding KeyName}" Width="150" FontWeight="Bold"/>
                                                                    <TextBlock Text="{Binding MappingCount, StringFormat='({0} mappings)'}" Foreground="Gray"/>
                                                                </StackPanel>
                                                            </DataTemplate>
                                                        </ListBox.ItemTemplate>
                                                    </ListBox>
                                                    <StackPanel Orientation="Horizontal">
                                                        <Button Content="{loc:Localize SettingsWindow.AddProfile}" Width="120" Margin="0,0,5,0"
                                                                Command="{Binding AddActivationKeyProfileCommand}"/>
                                                        <Button Content="{loc:Localize SettingsWindow.RemoveProfile}" Width="120"
                                                                Command="{Binding RemoveActivationKeyProfileCommand}"/>
                                                    </StackPanel>
                                                </StackPanel>
                                            </GroupBox>

                                            <!-- Behavior -->
                                            <GroupBox Header="{loc:Localize SettingsWindow.Behavior}" Margin="0,0,0,15">
                                                <StackPanel Margin="10">
                                                    <CheckBox Content="{loc:Localize SettingsWindow.EnableTouchCursor}"
                                                              IsChecked="{Binding IsEnabled}" Margin="0,5"/>
                                                    <CheckBox Content="{loc:Localize SettingsWindow.TrainingMode}"
                                                              IsChecked="{Binding TrainingMode}" Margin="0,5"/>
                                                    <CheckBox Content="{loc:Localize SettingsWindow.RunAtStartup}"
                                                              IsChecked="{Binding RunAtStartup}" Margin="0,5"/>
                                                    <CheckBox Content="{loc:Localize SettingsWindow.ShowInTray}"
                                                              IsChecked="{Binding ShowInTray}" Margin="0,5"/>
                                                    <CheckBox Content="{loc:Localize SettingsWindow.CheckUpdates}"
                                                              IsChecked="{Binding CheckUpdates}" Margin="0,5"/>
                                                    <CheckBox Content="{loc:Localize SettingsWindow.BeepForMistakes}"
                                                              IsChecked="{Binding BeepForMistakes}" Margin="0,5"/>
                                                    <CheckBox Content="{loc:Localize MainWindow.AutoSwitchToEnglish, Default='Auto-switch to English (Korean IME)'}"
                                                              IsChecked="{Binding AutoSwitchToEnglish}" Margin="0,5"/>

                                                    <Separator Margin="0,10"/>

                                                    <!-- Hold Delay -->
                                                    <TextBlock Text="{loc:Localize SettingsWindow.HoldDelay, Default='Activation Key Hold Delay (ms):'}" Margin="0,5,0,5"/>
                                                    <TextBlock Text="{loc:Localize SettingsWindow.HoldDelayDescription, Default='The activation key must be held for this duration before cursor mode activates.'}"
                                                               TextWrapping="Wrap" Margin="0,0,0,5" FontSize="11" Foreground="Gray"/>
                                                    <Grid Margin="0,5,0,10">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Slider Grid.Column="0" Minimum="0" Maximum="300"
                                                                TickFrequency="10" IsSnapToTickEnabled="True"
                                                                Value="{Binding HoldDelayMs}" Margin="0,0,10,0"/>
                                                        <TextBlock Grid.Column="1" Width="50" VerticalAlignment="Center"
                                                                   Text="{Binding HoldDelayMs, StringFormat='{}{0} ms'}"/>
                                                    </Grid>

                                                    <!-- Rollover Threshold -->
                                                    <TextBlock Text="{loc:Localize SettingsWindow.RolloverThreshold}" Margin="0,5,0,5"/>
                                                    <TextBlock Text="{loc:Localize SettingsWindow.RolloverThresholdDescription}"
                                                               TextWrapping="Wrap" Margin="0,0,0,5" FontSize="11" Foreground="Gray"/>
                                                    <Grid Margin="0,5">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*"/>
                                                            <ColumnDefinition Width="Auto"/>
                                                        </Grid.ColumnDefinitions>
                                                        <Slider Grid.Column="0" Minimum="0" Maximum="200"
                                                                TickFrequency="10" IsSnapToTickEnabled="True"
                                                                Value="{Binding RolloverThresholdMs}" Margin="0,0,10,0"/>
                                                        <TextBlock Grid.Column="1" Width="50" VerticalAlignment="Center"
                                                                   Text="{Binding RolloverThresholdMs, StringFormat='{}{0} ms'}"/>
                                                    </Grid>
                                                </StackPanel>
                                            </GroupBox>

                                            <!-- Language -->
                                            <GroupBox Header="{loc:Localize SettingsWindow.Language}" Margin="0,0,0,15">
                                                <StackPanel Margin="10">
                                                    <TextBlock Text="{loc:Localize SettingsWindow.LanguageDescription}"
                                                               TextWrapping="Wrap" Margin="0,0,0,10"/>
                                                    <ComboBox Width="200" HorizontalAlignment="Left"
                                                              ItemsSource="{Binding AvailableLanguages}"
                                                              DisplayMemberPath="NativeName"
                                                              SelectedValuePath="Code"
                                                              SelectedValue="{Binding SelectedLanguage}"/>
                                                </StackPanel>
                                            </GroupBox>

                                            <!-- About -->
                                            <GroupBox Header="{loc:Localize SettingsWindow.About}" Margin="0,0,0,15">
                                                <StackPanel Margin="10">
                                                    <TextBlock Text="{loc:Localize SettingsWindow.AboutTitle}" Margin="0,5" FontWeight="Bold"/>
                                                    <TextBlock Text="{loc:Localize SettingsWindow.AboutVersion}" Margin="0,5"/>
                                                    <TextBlock Text="{loc:Localize SettingsWindow.AboutOriginal}" Margin="0,5"/>
                                                    <TextBlock Text="{loc:Localize SettingsWindow.AboutLicense}" Margin="0,5"/>
                                                </StackPanel>
                                            </GroupBox>
                                        </StackPanel>
                                    </ScrollViewer>
                                </TabItem>

                                <!-- Key Mappings Tab -->
                                <TabItem Header="{loc:Localize SettingsWindow.TabKeyMappings}">
                                    <views:KeyMappingsView DataContext="{Binding}"/>
                                </TabItem>
                            </TabControl>

                            <!-- Bottom Buttons -->
                            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button Content="{loc:Localize SettingsWindow.ResetToDefaults}" Width="150" Height="30" Margin="0,0,10,0"
                                        Command="{Binding ResetToDefaultsCommand}"/>
                                <Button Content="{loc:Localize SettingsWindow.OK}" Width="80" Height="30" Margin="0,0,10,0"
                                        Command="{Binding SaveCommand}"/>
                                <Button Content="{loc:Localize SettingsWindow.Cancel}" Width="80" Height="30"
                                        Command="{Binding CancelCommand}"/>
                            </StackPanel>
                        </Grid>
                    </Border>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

</ResourceDictionary>
